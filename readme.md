# Gossip

This module uses ed25519, x25519, sha256, and shake256 to implement a
gossip protocol for passing messages between connected nodes.

## Overview

The general idea is that nodes communicate over connections (or send
messages in a connectionless setting), with each message being encrypted
for privacy and signed to prove authenticity; all unsigned messages are
dropped. Additionally, hashcash using a custom tapehash digest system is
used as an anti-spam measure; any message encountered that does not meet
the difficulty threshold is dropped. A 4-byte integer nonce is included
and incremented until the difficulty threshold is met.

When a valid message is received, it is added to the inbound message
queue to be handled by the registered message handler. When an action is
queued up by the message handler, it is added to the actions queue to be
handled by the action handler. When the node wishes to send a message,
it is added to the outbound queue to be handled by the registered
message sender. All handlers are invoked when `process()` is called,
starting with the message sender, then the message handler, then the
action handler, and finally the bulletin handler. Each call to
`process()` will pop a single item off of each queue to be handled by
the relevant handler.

There is also a system of Topics and Bulletins. The first 64 bytes of a
Bulletin are the header composed of a 32 byte Topic id and a 32 byte
Content id, with the remainder being content. A Topic id is the sha256
hash of the Topic descriptor bytes, which can be generated by calling
`Topic.from_descriptor`. A Node can subscribe to any Topic, and the
default subscriptions are the node beacon channel and bulletins sent to
the individual Node. A Node can also unsubscribe from any Topic. The
Content id is the sha256 hash of the content bytes, which can be
generated by calling `Content.from_content`.

Directly connected Nodes can be represented with the Neighbor class.
These Neighbors can be used to keep track of the Topics that they have
expressed interest in, but this is optional.

An important note is that the registered action handler must at a
minimum include a `store_and_forward` function that calls `mark_as_seen`
on the Node to add the Bulletin to the `content_seen` set. Old content
can be purged by periodically calling the `delete_old_content` method on
the Node. It is also worthwhile to include `request_synchronization`,
`synchronize_to`, `synchronize_from`, `request_content`, and
`serve_content` functions in the action handler to ensure that nodes
synchronize recent bulletins. The `request_synchronization` action
should share subscribed Topics, and the `synchronize_to` action should
send Content ids of Bulletins for the requested Topics. All
communications between nodes should take the form of Bulletins wrapped
in Messages.

When `mark_as_seen` is called, it pushes the Bulletin onto the new
bulletins queue to be handled by the registered bulletin handler on the
next `process()` call. The bulletin handler is responsible for storage
and retrieval of bulletins via the `handle`, `retrieve`, `list`, and
`query` methods.

The code is reasonably SOLID and thoroughly tested.

## Status

- [x] Globals and miscellaneous functions + tests
- [x] Interfaces + tests
- [x] Basic Classes + tests
- [ ] Example implementation using sockets

## Installation

Currently, this project is still in development, so the best way to install is
to clone the repo and then run the following from within the root directory
(assuming a Linix terminal):

```
python -m venv venv/
source venv/bin/activate
pip install -r requirements.txt
```

On Windows, you may have to run `source venv/Scripts/activate`.

These instructions will change once development is complete and the module is
published as a package.

## Models and Types

@todo

## Network Stack

@todo

## Tests

Open a terminal in the root directory and run the following:

```
cd tests/
python -m unittest
```

## ISC License

Copyleft (c) 2022 k98kurz

Permission to use, copy, modify, and/or distribute this software
for any purpose with or without fee is hereby granted, provided
that the above copyleft notice and this permission notice appear in
all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR
CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,
NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
